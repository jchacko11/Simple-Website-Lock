<html style="overflow: auto;">
  <head>
    <link href="https://cdn.jsdelivr.net/npm/bulma@0.8.2/css/bulma.min.css" rel="stylesheet" type="text/css" />
  </head>
  <body id="body">
    <div id="container">
      <h1 id="header" class="title is-4 is-hidden">Enter the password</h1>
      <form id="form" class="field has-addons">
        <div class="control">
          <input id="password" class="input" type="text" placeholder="Enter the password" autocomplete="off">
        </div>
        <div class="control">
          <button id="submit" type="submit" class="button is-info">
          Submit
          </button>
        </div>
      </form>
      <div id="failure" class="notification is-danger is-light is-hidden content">
        Wrong answer. Try again!
      </div>
      <div id="success" class="notification is-success is-light is-hidden content"></div>
    </div>
    <script>
      var submit = document.getElementById('submit')
      var password = document.getElementById("password")
      var failure = document.getElementById("failure")
      var success = document.getElementById("success")
      
      var body = document.getElementById('body')
      var container = document.getElementById('container')
      var header = document.getElementById('header')

      var name = "{{ name }}"


      let initRequest = new XMLHttpRequest()
      initRequest.open('GET', '/api/get?name=' + name)
      initRequest.send()
    
      initRequest.onload = () => {
    
        if (initRequest.status == 200) {
          console.log(initRequest.response)

          let response = JSON.parse(initRequest.response)
    
          if(initRequest.response != 'false'){

            console.log(response)

            if(response['background'] && response['background'] != "unset"){
              body.style.background = response['background']
            }

            if(response['box'] == "true"){
              container.style.height = "calc(100vh - 4rem)"
              container.style.overflow = "auto"
              container.classList.add("box")
              body.style.padding = "1rem"
            }else{
              body.style.height = "100vh"
            }

            if(response['header'] == "true"){
              header.classList.remove("is-hidden")
            }


          }
    
        }
      }


      function get(name){
        if(name=(new RegExp('[?&]'+encodeURIComponent(name)+'=([^&]*)')).exec(location.search))
            return decodeURIComponent(name[1]);
      }
      
      const form = document.getElementById('form');
      form.addEventListener('submit', logSubmit);
      
      function logSubmit(e){
        if(e)
          e.preventDefault();     
        
        submit.classList.add("is-loading")
      
        let request = new XMLHttpRequest()
        request.open('GET', '/api/check?name=' + name + '&password=' + password.value)
        request.send()
      
        request.onload = () => {
      
          if (request.status == 200) {
            console.log(request.response)
            let response = JSON.parse(request.response)
      
          if(request.response != 'false'){
            success.innerHTML = response["success"]

            success.classList.remove("is-hidden");
            failure.classList.add("is-hidden");
          }else{ 
            failure.classList.remove("is-hidden");
            success.classList.add("is-hidden");
          }
      
          }
          document.getElementById('submit').classList.remove("is-loading")
        }
              
      }
        
    </script>

    <style>
      .buttons{
        padding-top: .5rem;
      }
      .notification{
        margin-right: 1rem;
      }
    </style>

  </body>
</html>